\chapter{Constructing the Lebesgue measure}\label{ch:ch1}\label{measureChapter}
A measure is a rule by which we assign ``size'' to certain sets.
The notion of a measure generalizes a handful of familiar notions, which we now review.
\begin{example}\label{examples of measures}
If $X$ is a set, we will define a measure known as the \dfn{counting measure} $\mu$ of $X$, by declaring that for every finite subset $Y \subseteq X$, $\mu(Y)$ is the cardinality of $Y$ (i.e.\ the number of elements of $Y$).

We define the \dfn{Lebesgue measure}\footnote{Named after Henri Lebesgue (1875--1941), a French mathematician who introduced measure theory in his book \emph{Intégrale, longueur, aire} (\emph{Integral, length, area}).}
$\mu$ on boxes $[a_{1}, b_{1}] \times \cdots \times [a_{d}, b_{d}] \subseteq \RR^{d}$ by declaring that
\[\mu([a_{1}, b_{1}] \times \cdots \times [a_{d}, b_{d}]) = (b_{1} - a_{1})(b_{2} - a_{2})\cdots(b_{d} - a_{d}).\]
When $d = 1$ this is just the familiar notion of the length of a line segment; when $d = 2$ this is the area of a rectangle; when $d = 3$ this is the volume of a rectangular prism.

In probability theory, one is concerned with sets of ``outcomes''; the sets are known as ``events''. Given an event $E$ in a sample space $X$, we define $\mu(E)$ to be the probability that $\mu$ occurs. Thus $\mu(X) = 1$.
\end{example}

\begin{subsec}
In all of the above examples, $\mu$ has the property that if $Y_{1}, \dots, Y_{n}$ is a collection of disjoint sets (thus $Y_{i} \cap Y_{j} = \emptyset$ whenever $i \neq j$), then
\[\mu\bigcup_{i} Y_{i} = \sum_{i} \mu(Y_{i}).\]
In fact this can be made to be true not just for finite, but countable, collections of disjoint sets.
So it will be natural to require that the domain of our measure $\mu$ be closed under taking countable unions.
\end{subsec}

\section{Algebras of sets}
Encouraged by the introduction, we study sets $R$, whose elements are sets, such that $R$ is closed under operations similar to countable union.
This will seem obnoxious and abstract at first, but I ask for your patience; it won't take long to get through this section.

\begin{definition}
By a \dfn{ring} $R$ we mean a nonempty set, whose elements are sets, such that if $X, Y \in R$ then the union $X \cup Y$ and set difference $X \setminus Y$ are both in $R$.
\end{definition}

\begin{subsec}
Let $R$ be a ring.
One easily checks that if $X_{1}, \dots, X_{n} \in R$ then $X_{1} \cup \cdots \cup X_{n} \in R$ and $X_{1} \cap \cdots \cap X_{n} \in R$ (this follows by induction, because $X \cap Y = X \setminus (X \setminus Y)$).
Moreover, since $R$ is nonempty, say $X \in R$, $X \setminus X \in R$, so $R$ contains the empty set.
\end{subsec}

\begin{definition}
Let $X$ be a set. By an \dfn{algebra} in $X$ we mean a ring such that $X \in R$ and for every $Y \in R$, $Y \subseteq X$.
\end{definition}

\begin{definition}
By a \dfn{$\sigma$-ring}\footnote{Here $\sigma$ should be thought of as meaning ``countable''.} $R$ we mean a ring which is closed under countable unions, thus for every sequence ${(X_{n})}_{n}$ of sets in $R$, $\bigcup_{n} X_{n} \in R$.

We define a \dfn{$\sigma$-algebra} in a set $X$ to be a $\sigma$-ring which is an algebra in $X$.
\end{definition}

\begin{subsec}
Let $R$ be a $\sigma$-ring.
In proofs it will frequently be useful to replace sequences of sets in $R$ with sequences of disjoint sets, without leaving $R$.
The below lemma allows us to accomplish this.
\end{subsec}

\begin{lemma}
Let $\Sigma$ be a $\sigma$-ring.
Let ${(E_{n})}_{n}$ be a sequence of sets in $\Sigma$. Then there is a sequence of disjoint sets ${(F_{n})}_{n}$ in $\Sigma$ such that $F_{n} \subseteq E_{n}$ and
\[\bigcup_{n=1}^{\infty} E_{n} = \bigcup_{n=1}^{\infty} F_{n}.\]
\end{lemma}
\begin{proof}
Let $F_{1} = E_{1}$ and for $n \geq 2$,
\[F_{n} = E_{n} \setminus \bigcup_{i=1}^{n-1} F_{i}.\]
Then clearly the $F_{n}$ are disjoint and have the same union as the $E_{n}$.
\end{proof}

\begin{exercise}
Let $X$ be a set.
Show that the power set $2^{X}$ --- that is, the set of all subsets of $X$ --- is a $\sigma$-algebra, as is $\{\emptyset, X\}$.
\end{exercise}

\begin{exercise}
Let $R$ be the set of bounded subsets of $\RR$.
Show that $R$ is a ring, but neither an algebra in $\RR$ nor a $\sigma$-ring.
\end{exercise}

\begin{exercise}
Recall the algebraic definition of a ring: a set equipped with an addition and a multiplication satisfying certain axioms.
Show that every ring (in our sense) is an algebraic ring, where addition and multiplication are replaced by symmetric difference and intersection, respectively.
\end{exercise}

\begin{exercise}
Let $\Sigma$ be an infinite $\sigma$-ring. Show that $\Sigma$ has cardinality at least that of $2^{\NN}$, the power set of the natural numbers.
(Hint: let $\Sigma_{0} = \Sigma$. Choose $X_{n} \in \Sigma_{n}$ appropriately and let $\Sigma_{n+1} = \{Y \in \Sigma_{n}: X \cap Y = \emptyset\}$. If done correctly, you should be able to find an injective function $F: 2^{\NN} \to \Sigma$ such that $F(\{n\}) = X_{n}$).
\end{exercise}

\section{The Borel $\sigma$-algebra}
We now consider certain $\sigma$-algebras that are built up by a process similar to the notion of ``generators and relations'' from algebra.

\begin{lemma}\label{intersection of rings is ring}
The intersection of a nonempty set of rings (resp. $\sigma$-rings, algebras, or $\sigma$-algebras) is a ring (resp. $\sigma$-ring, etc.)
\end{lemma}
\begin{proof}
We prove this for a set of rings (the other cases are similar). Let $\mathcal R$ be a set of rings and let $R$ be its intersection.
If $X, Y \in R$ then for every $S \in \mathcal R$, $X, Y \in S$ so $X \cup Y \in S$ and $X \setminus Y \in S$.
Therefore $X \cup Y, X \setminus Y \in R$.
\end{proof}

\begin{subsec}
Whenever we refer to a ``smallest'' set $X$ with a property $P$, we mean that for every set $Y$ with property $P$, $X \subseteq Y$.
\end{subsec}

\begin{lemma}
If $\mathcal C$ is a set of sets, there is a smallest ($\sigma$)-ring containing $\mathcal C$. If in fact $\mathcal C$ is a collection of subsets of a set $X$, there is a smallest ($\sigma$)-algebra containing $\mathcal C$.
\end{lemma}
\begin{proof}
In the case of a ($\sigma$)-ring, let $X$ be the union of all elements of $\mathcal C$.
We now prove this claim for the case of a ring; the other cases are similar.

The power set $2^{X} = \{Y: Y \subseteq X\}$ is clearly a ring which contains every element of $\mathcal C$.
Let $\mathcal R$ be the set of all rings that contain every element of $\mathcal C$; since $2^{X} \in \mathcal R$, $\mathcal R$ is nonempty.
By Lemma~\ref{intersection of rings is ring}, the intersection $R$ of $\mathcal R$ is a ring.
But for every $C \in \mathcal C$, $C \in R$ since $C$ is in every element of $\mathcal R$.
Therefore $R$ contains $\mathcal C$.
\end{proof}

\begin{definition}
The smallest $\sigma$-algebra containing every element of a set $\mathcal C$ is called the \dfn{$\sigma$-algebra generated by} $\mathcal C$.
We denote it by $\sigma(\mathcal C)$.
\end{definition}

\begin{subsec}
The advantage of defining a $\sigma$-algebra by referring to its generators is that it is easy to show that every element of the $\sigma$-algebra has a given property.
This is quite easy to prove, as the following lemma shows, but so very useful.
\end{subsec}

\begin{lemma}\label{generators and relations}
Let $X$ be a set, and let $P$ be a property that subsets of $X$ can have.
Assume that $\mathcal C$ is a set whose elements are subsets of $X$, and every element of $\mathcal C$ has property $P$.
If the set of all subsets of $X$ with property $P$ is a $\sigma$-algebra, then every element of $\sigma(\mathcal C)$ has property $P$.
\end{lemma}
\begin{proof}
Let $\Sigma$ be the $\sigma$-algebra of all subsets of $X$ with property $P$.
Then $\Sigma$ contains $\sigma(\mathcal C)$.
\end{proof}

\begin{subsec}
We now come across the most important example of a $\sigma$-algebra.
If the reader is unfamiliar with topological spaces, in the below definition it suffices to take $X = \RR^{d}$, and $\mathcal T$ the set of all unions of open balls in $\RR^{d}$, as this will be the most important case.
\end{subsec}

\begin{definition}
Let $X$ be a topological space.
Let $\mathcal T$ be the topology of $X$, the set of all open subsets of $X$.
We define the \dfn{Borel $\sigma$-algebra}\footnote{Named after Émile Borel (1871--1956), a French probabilist who introduced many of the key ideas of measure theory.}
$\mathcal B$ of $X$ by $\mathcal B = \sigma(\mathcal T)$.
A \dfn{Borel set} in $X$ is an element of $\mathcal B$.
\end{definition}

\begin{subsec}
Let $X$ be a topological space.
It follows from the definition that every open or closed subset of $X$ is Borel, but also that countable unions of complements of countable unions of complements of countable unions of complements of\dots of open sets of $X$ is Borel.
However, some Borel sets can be even more complicated than that.
\end{subsec}

\begin{lemma}
Let $X$ be a topological space.
Assume that $P$ is a property that subsets of $X$ can have, and that every open set has property $P$.
If the set of subsets of $X$ with property $P$ is a $\sigma$-algebra, then every Borel set has property $P$.
\end{lemma}
\begin{proof}
By Lemma~\ref{generators and relations}.
\end{proof}

\begin{subsec}
When is a set Borel? If $X = \NN$, then every set is open and so every set is Borel.
But it is not so obvious how to check whether a subset of $\RR^{d}$ is Borel.
Certainly any set you will ever ``naturally'' encounter is Borel, but not every subset of $\RR^{d}$ is Borel.
\end{subsec}

\begin{lemma}\label{Borel sigma algebra}
There exists a subset of $\RR^{d}$ which is not Borel.
In fact, the set of Borel subsets of $\RR^{d}$ has strictly lower cardinality than the set of all subsets of $\RR^{d}$.
\end{lemma}
\begin{proof}[Proof (omit on first reading)]
Let $\Sigma_{1} = \mathcal T$ be the topology of $\RR^{d}$.
Given $\Sigma_{\alpha}$, $\alpha$ a countable ordinal (see Definition~\ref{ordinal dfn}), let $\Pi_{\alpha}$ be the set of all complements of elements of $\Sigma_{\alpha}$.
Let $\Sigma_{\alpha+1}$ be the set of countable unions of elements of $\Pi_{\alpha}$.
If $\beta < \omega_{1}$ is not equal to $\alpha+1$ for any $\alpha$, let $\Sigma_{\beta} = \bigcup_{\alpha < \beta} \Sigma_{\alpha}$.
Therefore $\Sigma_{\alpha}$ and $\Pi_{\alpha}$ are defined for all $\alpha < \omega_{1}$ by transfinite recursion (see the remarks after Theorem~\ref{transfinite induction}).
We note that $\Sigma_{0}$ has cardinality $\beth_{1}$ by Theorem~\ref{cardinality of topology}.

Now the mapping $A \mapsto A^{c}$ is a bijection $\Sigma_{\alpha} \to \Pi_{\alpha}$.
Moreover if $\Pi_{\alpha}$ has cardinality $\beth_{1}$ (see Definition~\ref{beth dfn}) then so does $\Sigma_{\alpha+1}$, since each element of $\Sigma_{\alpha+1}$ can be expressed in terms of a countable number of elements of $\Pi_{\alpha}$, and $\beth_{1} \times \beth_{1} \times \cdots$ has cardinality $\beth_{1}$ by Theorem~\ref{cardinal arithmetic trivial}.
Finally if $\beta$ is a countable limit ordinal and for every $\alpha < \beta$, $\Sigma_{\alpha}$ is countable, then $\Sigma_{\beta}$ is a countable union of sets of cardinality $\beth_{1}$, hence has cardinality $\beth_{1}$ by Theorem~\ref{cardinal arithmetic trivial}.
It follows by induction that for every countable ordinal $\alpha$, $\Sigma_{\alpha}$ has cardinality $\beth_{1}$.

Now every Borel set is in $\Sigma_{\alpha}$ for some $\alpha$, since it was obtained by applying countable union and complement countably many times to an open set, and thus is in $\Sigma_{\omega_{1}} = \bigcup_{\alpha < \omega_{1}} \Sigma_{\alpha}$.
But $\Sigma_{\omega_{1}}$ is a union of $\aleph_{1}$ many sets of cardinality $\beth_{1}$, so has cardinality $\beth_{1}$ by Theorem~\ref{cardinal arithmetic trivial},
since $\aleph_{1} \leq \beth_{1}$ (which follows by Zermelo's well-ordering Theorem~\ref{well-ordering theorem}).
Therefore $\Sigma_{\omega_{1}}$ is the set of all Borel sets, and has cardinality $\beth_{1}$.

But $\Sigma_{\omega_{1}}$ is a subset of the power set $2^{\RR}$, which has cardinality $\beth_{2}$. Thus there is an element of $2^{\RR}$ which is not Borel.
\end{proof}

\begin{exercise}
Show that the set of half-open intervals $[a, b)$ generates the Borel $\sigma$-algebra of $\RR$.
\end{exercise}

\begin{exercise}
Show that the set of compact subsets of $\RR^{d}$ generates the Borel $\sigma$-algebra of $\RR^{d}$.
Show that there exists a metric space $X$, such that the set of compact subsets of $X$ does not generate the Borel $\sigma$-algebra of $X$. (Hint: Cardinality!)
\end{exercise}

\begin{exercise}\label{Jordan content 1}
Let us say that a bounded subset $A$ of $\RR$ has \dfn{Jordan content} if the indicator function $1_{A}$ of $A$ is Riemann integrable.
Here $1_{A}(x) = 1$ if $x \in A$ and $1_{A}(x) = 0$ otherwise.
Show that $\QQ$ is Borel, but does not have Jordan content.
Later we will show that every set with Jordan content is Borel, and that it is reasonable to define the length of any Borel set.
So our definitions will generalize those that one learned in a first course in real analysis.
\end{exercise}


\section{The definition of a measure}
We are almost ready to define a measure.
Throughout this section, the reader should refer back to Example~\ref{examples of measures} frequently, as the point of the definitions in this section is to generalize those concepts.

\begin{subsec}
Let $(-\infty, \infty]$ denote the set of real numbers, plus another point $\infty$ which is greater than any real number.
We define addition on $[0, \infty]$ by requiring that $\infty + a = \infty$ for any $a \in \RR$.
We do not define addition on $[-\infty, \infty]$, which would include $-\infty$, because the expression $\infty - \infty$ makes no sense.
\end{subsec}

%\begin{definition}
%Let $B$ be a Banach space or $(-\infty, \infty]$, and let $\mathcal C$ be a collection of sets
%We say that a function $\mu: \mathcal C \to B$ such that for every disjoint sequence of sets ${(X_{n})}_{n}$ in $\Sigma$ such that $\bigcup_{n} X_{n} %\in \mathcal C$,
%\[\mu\bigcup_{n} X_{n} = \sum_{n=1}^{\infty} \mu(X_{n}),\]
%is called a \dfn{$\sigma$-additive fuction}.
%\end{definition}
%Here the infinite sum is meant in the sense of (\ref{banach space series}) if $B$ is a Banach space.

\begin{definition}
Let $\mathcal C$ be a collection of sets.
A function $\mu: \mathcal C \to [0, \infty]$ such that for every disjoint sequence of sets ${(X_{n})}_{n}$ in $\Sigma$ such that $\bigcup_{n} X_{n} \in \mathcal C$,
\[\mu\bigcup_{n} X_{n} = \sum_{n=1}^{\infty} \mu(X_{n}),\]
is called a \dfn{$\sigma$-additive fuction}.
\end{definition}

\begin{definition}
A \dfn{measure} is a $\sigma$-additive function defined on a $\sigma$-algebra $\Sigma$ on a set $X$ which is not identically $\infty$.
If we wish to emphasize that the codomain of a measure is $[0, \infty]$, we will call it a \dfn{positive measure}.

We call elements of $\Sigma$ \dfn{measurable sets} and call $(X, \Sigma)$ a \dfn{measurable space}.
If $\mu$ is a measure on $\Sigma$, we call $(X, \Sigma, \mu)$ a \dfn{measured space}.

If the image of $\mu$ is $[0, 1]$, we say that $\mu$ is a \dfn{probability measure}.
\end{definition}

\begin{lemma}\label{empty set is null}
For any measure $\mu$, $\mu(\emptyset) = 0$.
\end{lemma}
\begin{proof}
Since $\mu$ is a measure, there is a measurable set $Y$ such that $\mu(Y) \neq \infty$.
Then $Y = Y \cup \emptyset$ and $Y \cap \emptyset = \emptyset$, so
\[\mu(Y) = \mu(Y) + \mu(\emptyset).\]
Therefore $\mu(\emptyset) = 0$.
\end{proof}

\begin{example}
The examples in Example~\ref{examples of measures} are $\sigma$-additive.
However, they are not all defined on $\sigma$-algebras; for example, the union of two boxes $\prod_{i} [a_{i}, b_{i}]$ is not a box.
Counting measure is defined on the $\sigma$-algebra of every subset of $X$, so counting measure is actually a measure.

In fact, it is not yet clear that there are any interesting measures other than counting measure!
We'll have to do a lot of work before we'll be ready to introduce other examples of measures.
\end{example}

\begin{subsec}
Recall that if $f$ is a function (say, on a metric space), then $f$ is continuous iff for every sequence of points $(x_{n})$,
\[\lim_{n \to \infty} f(x_{n}) = f\left(\lim_{n \to \infty} x_{n}\right).\]
We want to define something analogous for measures, so we need to define the ``limit'' of a sequence of measurable sets.
More precisely, if $E_{1} \subseteq E_{2} \subseteq E_{3} \subseteq \cdots$, we can view $\bigcup_{n} E_{n}$ as the limit of the sequence $(E_{n})$.
Similarly we can define $\bigcap_{n} E_{n}$ to be the limit of the $(E_{n})$ if $E_{1} \supseteq E_{2} \supseteq \cdots$.
This allows us to show that measures are ``continuous''.
\end{subsec}

\begin{theorem}[continuity of measure]
Let $\mu$ be a measure, $(E_{n})$ a sequence of measurable sets, and $E$ a measurable set.
If one of the following is true:
\begin{enumerate}
\item Either $E_{1} \subseteq E_{2} \subseteq E_{3} \subseteq \cdots$ and $E = \bigcup_{n} E_{n}$,
\item or $E_{1} \supseteq E_{2} \supseteq E_{3} \supseteq \cdots$, $E = \bigcap_{n} E_{n}$, and there is $n$ such that $\mu(E_{n}) < \infty$,
\end{enumerate}
then
\begin{equation}
\label{continuity of measure equation}
\lim_{n \to \infty} \mu(E_{n}) = \mu(E).
\end{equation}

\end{theorem}
\begin{proof}
We first handle the increasing case.
Set $F_{1} = E_{1}$ and $F_{n} = E_{n} \setminus E_{n - 1}$. Then $E = \bigcup_{n} F_{n}$ and $E_{n} = \bigcup_{m \leq n} F_{m}$, and the $F_{n}$ are disjoint.
So
\[\mu(E) = \sum_{n=1}^{\infty} \mu(F_{n}) = \lim_{n \to \infty} \sum_{m=1}^{n} \mu(F_{m}) = \lim_{n \to \infty} \mu(E_{n})\]
which is (\ref{continuity of measure equation}).
As for the decreasing case, set $F_{n} = E_{1} \setminus E_{n}$; then the $F_{n}$ increase to $F = E_{1} \setminus E$. So
\[\lim_{n \to \infty} \mu(E_{1}) - \mu(E_{n}) = \lim_{n \to \infty} \mu(F_{n}) = \mu(F) = \mu(E_{1}) - \mu(E)\]
which can be rearranged to give (\ref{continuity of measure equation}).
\end{proof}

\begin{example}
The continuity of measure theorem is sharp in the sense that the hypothesis in the decreasing case that $\mu(E_{n}) < \infty$ cannot be omitted.
Consider counting measure $\mu$, defined on all subsets of $\NN$.
Let $E = \emptyset$, $E_{1} = \NN$, and given the infinite set $E_{n}$, choose the least element of $E_{n}$ and discard it to get an infinite set $E_{n + 1}$.
Thus $\mu(E_{n}) = \infty$, but $E_{n}$ does not contain any of $1, \dots, n - 1$, so $\bigcap_{n} E_{n} = E$ and $\mu(E) = 0$.
\end{example}

\begin{subsec}
We now introduce an important class of $\sigma$-additive functions defined for certain subsets of $\RR$, known as Stieltjes premeasures\footnote{Named after Thomas Stieltjes (1856--1894), who introduced the Riemann-Stieltjes integral, a weighted version of the Riemann integral that inspired the notion of a Stieltjes premeasure.}.
Eventually we will modify their definition so that they are defined for every Borel subset of $\RR$.
Since the Borel sets form a $\sigma$-algebra, this will define a measure on the Borel sets, known as a Stieltjes measure.
\end{subsec}

\begin{subsec}
Recall that a function $f$ on an interval $I$ is said to be ``left-continuous'' if for every $x \in I$,
\[f(x) = \lim_{\varepsilon \to 0^+} f(x - \varepsilon).\]
Here the limit is taken over \emph{positive} $\varepsilon$, and so ignores the behavior of $f$ to the right of $x$.
Clearly any continuous function is left-continuous.
One can also define right-continuous functions by ignoring the behavior of $f$ to the left of $x$ instead.
\end{subsec}

\begin{figure}
\label{Heaviside figure}
\caption{The Heaviside function (in blue) and an approximation to its derivative (in green).
As the approximation improves, it converges to $0$ everywhere except at the origin, where it blows up.}
\centering \includegraphics[width=0.5\textwidth]{graphics/heaviside}
\end{figure}

\begin{example}
The \dfn{Heaviside step function}\footnote{Named after Oliver Heaviside (1850--1925), an engineer who introduced an early version of the ``distributional calculus'' used to solve differential equations. Mathematicians did not consider the distributional calculus rigorous until the 1950s, however.}
\[H(x) = \begin{cases}
0, & x \leq 0\\
1, & x > 0
\end{cases}\]
is a useful example of a left-continuous function which is not continuous.
Clearly the derivative $H'(x)$ exists if $x \neq 0$, and in that case $H'(x) = 0$.
We want to say that $H'(0) = \infty$ in some suitable sense, and in fact that for any $\varepsilon > 0$,
\[\int_{-\infty}^{\infty} H'(x)~dx = \int_{-\varepsilon}^{\varepsilon} H'(x)~dx = 1.\]
Of course we can't do that, because the limit that would define $H'(0)$ does not exist.
See Figure \ref{Heaviside figure}.
\end{example}

\begin{definition}
Let $f: \RR \to \RR$ be a nondecreasing, left-continuous function.
Define
\[\mu_{f}([a, b)) = f(b) - f(a).\]
We call $\mu_{f}$ the \dfn{Stieltjes premeasure} of $f$.
\end{definition}

\begin{subsec}
A nondecreasing function can only be discontinuous on a countable set (Exercise~\ref{nondecreasing exercise}).
Thus we can turn a nondecreasing function $f$ into a left-continuous function $g$ by declaring that if $f$ is continuous at $x$ then $g(x) = f(x)$, and otherwise setting
\[g(x) = \lim_{\varepsilon \to 0} f(x - \varepsilon).\]
Henceforth we will talk about Stieltjes premeasures of any nondecreasing function, knowing that we may have to redefine them on a countable set in order that the definition make sense.
\end{subsec}

\begin{example}
If $f(x) = x$, then the Stieltjes premeasure of an interval $[a, b)$ under $f$ is just its length $b - a$.
This premeasure is known as the \dfn{Lebesgue premeasure}.
It will be by far the most important premeasure that we study.
If the following theory ever seems too abstract, try it out on the Lebesgue premeasure!
\end{example}

\begin{example}
The Stieltjes premeasure of a differentiable function $f$ can be thought of as ``weighted length''; $\mu_{f}([a, b)) > b - a$ provided that $f' > 1$ on $b - a$, and $\mu_{f}([a, b)) < b - a$ if $f' < 1$.
This is just an expression of the fundamental theorem of calculus: if $f$ is differentiable then
\[\mu_{f}([a, b)) = f(b) - f(a) = \int_{a}^{b} f'(x)~dx.\]
Since $f$ is nondecreasing, $f' \geq 0$.
This is our first clue that there is some connection between integration and measure theory.
\end{example}

\begin{example}
The Stieltjes premeasure of the Heaviside function $H$ will allow us to make some sense of our previous waffling about its derivative.
If $0 \notin [a, b)$ then $\mu_{H}([a, b)) = 0$.
Otherwise, $a \leq 0 < b$ and $H(b) = 1$, $H(a) = 0$; thus $\mu_{H}([a, b)) = 1$.
If one instead considers a finite set $X = \{x_{1}, \dots, x_{n}\}$ and
\[f(x) = \sum_{j=1}^{n} H(x - x_{j}),\]
then $\mu_{f}([a, b))$ is the cardinality of $X \cap [a, b)$.
\end{example}

\begin{theorem}
Every Stieltjes premeasure is $\sigma$-additive.
In particular, Lebesgue premeasure is $\sigma$-additive.
\end{theorem}
\begin{proof}
Let $\mu_{f}$ be a Stieltjes premeasure.
Let $E_{n} = [a_{n}, b_{n})$, assume that the $E_{n}$ are disjoint, and let $E = \bigcup_{n} E_{n}$.
Suppose that $E = [a, b)$. We must show
\begin{equation}\label{SPM sum}
f(b) - f(a) = \sum_{n=1}^{\infty} f(b_{n}) - f(a_{n}).
\end{equation}
To do so, we first note that since $f$ is nondecreasing, the quantities $\mu_{f}([a_{n}, b_{n}))$ are positive, so the sum in (\ref{SPM sum}) converges absolutely.
Thus we may rearrange the order of the summands without affecting the value of the sum, so we can assume that $a_{n} \leq a_{n+1}$ for every $n$, by reordering the intervals $E_{n}$.
Since the intervals are disjoint it follows that $b_{n} \leq a_{n+1}$.

We now prove
\[\mu_{f}(E) \geq \sum_{n=1}^{\infty} \mu_{f}(E_{n}).\]
To do this, we fix an $N$ and show that
\begin{equation}\label{SPM sum bound 1}
f(b) - f(a) \geq \sum_{n=1}^{N} f(b_{n}) - f(a_{n}).
\end{equation}
Now $b \geq b_{n}$ and $a \leq a_{n}$, so $f(b) - f(a) \geq f(b_{N}) - f(a_{1})$, but
\[\sum_{n=1}^{N} f(b_{n}) - f(a_{n}) = f(b_{N}) - f(a_{1}) + \sum_{n=1}^{N-1} f(b_{n}) - f(a_{n+1}).\]
But $b_{n} \leq a_{n+1}$ so $f(b_{n}) \leq f(a_{n+1})$, so
\[\sum_{n=1}^{N-1} f(b_{n}) - f(a_{n+1}) \leq 0.\]
Therefore
\[\sum_{n=1}^{N} f(b_{n}) - f(a_{n}) \leq f(b_{N}) - f(a_{1}) \leq f(b) - f(a).\]
This proves (\ref{SPM sum bound 1}).

Conversely, we must show that
\[\mu_{f}(E) \leq \sum_{n=1}^{\infty} \mu_{f}(E_{n}).\]
It suffices to show that for every $\varepsilon > 0$,
\begin{equation}\label{SPM sum bound 2}
f(b) - f(a) \leq \varepsilon + \sum_{n=1}^{\infty} f(b_{n}) - f(a_{n}).
\end{equation}
Now choose $b' < b$ such that $f(b') \geq f(b) - \varepsilon/2$ and for each $n$ choose $a_{n}' < a_{n}$ such that $f(a_{n}') \geq f(a_{n}) - \varepsilon/2^{n+1}$.
Such $a_{n}'$ and $b'$ exist because $f$ is left-continuous.
Now
\[[a_{n}', b'] \subseteq [a, b) = \bigcup_{n=1}^{\infty} [a_{n}, b_{n}) \subseteq \bigcup_{n=1}^{\infty} (a_{n}', b_{n}).\]
Therefore the $(a_{n}', b_{n})$ are an open cover of $[a_{n}', b]$, so by the Heine-Borel theorem there is an $N$ such that
\[[a_{n}', b'] \subseteq \bigcup_{n=1}^{N} (a_{n}', b_{n}).\]
If any interval is superfluous, we now discard it.
Then the way we ordered the intervals, $a_{n+1}' \leq b_{n}$.
TODO:\@ Draw a picture.
Moreover, $a_{1}' \leq a$ and $b' \leq b_{N}$. Then
\begin{align*}
f(b) - f(a) &\leq f(b') - f(a) + \frac{\varepsilon}{2}\\
& \leq f(b_{N}) - f(a_{1}') + \frac{\varepsilon}{2}\\
& \leq f(b_{N}) - f(a_{1}') + \frac{\varepsilon}{2} + \sum_{n=1}^{N-1} f(b_{n}) - f(a_{n+1}')\\
& \leq \frac{\varepsilon}{2} + \sum_{n=1}^{N} f(b_{n}) - f(a_{n}')\\
& \leq \frac{\varepsilon}{2} + \sum_{n=1}^{N} f(b_{n}) - f(a_{n}) + \frac{\varepsilon}{2^{n+1}}\\
& \leq \varepsilon + \sum_{n=1}^{N} f(b_{n}) - f(a_{n})
\end{align*}
where we used Zeno's paradox
\begin{equation}\label{zeno}
\sum_{n=1}^{\infty} \frac{1}{2^{n}} = 1
\end{equation}
to sum the geometric series of $\varepsilon$'s.
But this estimate is exactly (\ref{SPM sum bound 2}).
\end{proof}

\begin{exercise}\label{nondecreasing exercise}
Show that a nondecreasing function on $\RR$ can only be discontinuous on a countable set.
\end{exercise}

\begin{exercise}
Let $\Sigma$ be a $\sigma$-ring, and let $\mu: \Sigma \to B$ be a function such that whenever $A_{1} \subseteq A_{2} \subseteq A_{3} \subseteq \cdots$,
\[\lim_{n \to \infty} \mu(A_{n}) = \mu\left(\bigcup_{n=1}^{\infty} A_{n}\right).\]
Show that if $\mu$ is \dfn{additive} (that is, if $A \cap B = \emptyset$, then $\mu(A \cup B) = \mu(A) + \mu(B)$), then $\mu$ is $\sigma$-additive.
\end{exercise}

\begin{exercise}
Let $\mathcal F$ be the vector space of left-continuous, nondecreasing functions and $\mathcal M$ the vector space of Stieltjes premeasures.
Show that the map $f \mapsto \mu_{f}$ which assigns a function to its Stieltjes premeasure is a linear map $\mathcal F \to \mathcal M$.
\end{exercise}

\section{Premeasures and outer measures}
Encouraged by the previous section, we now define premeasures in general.
Our goal is to define a $\sigma$-additive function that can be extended to a measure in a unique way; thus, to define a measure, it will suffice to define a premeasure.

\begin{definition}
A set of sets $P$ is said to be a \dfn{semiring} if $\emptyset \in P$ and for every $E, F \in P$:
\begin{enumerate}
\item $E \cap F \in P$.
\item There are $G_{1}, \dots, G_{m}$ disjoint such that
\[E \setminus F = \bigcup_{n=1}^{m} G_{n}.\]
\end{enumerate}
A $\sigma$-additive function $P \to [0, \infty]$ which is not identically $\infty$ is called a \dfn{premeasure}.
\end{definition}

\begin{example}
The set of all half-open intervals $[a, b)$ is a semiring, so a Stieltjes premeasure is a premeasure.
\end{example}

\begin{lemma}\label{semiring prop 1}
Let $P$ be a semiring and $\mu$ a premeasure on $P$. Then:
\begin{enumerate}
\item If $E_{1}, \dots, E_{m} \in P$ then there are disjoint $F_{1}, \dots, F_{n} \in P$ such that
\[((((E_{1} \setminus E_{2}) \setminus E_{3}) \setminus \cdots) \setminus E_{m}) = \bigcup_{i=1}^{n} F_{i}.\]
\item $\mu(\emptyset) = 0$.
\end{enumerate}
\end{lemma}
\begin{proof}
Exercise~\ref{semiring exercise}.
\end{proof}

\begin{lemma}\label{semiring prop 2}
Let $P$ be a semiring and $\mu$ a premeasure on $P$. Then:
\begin{enumerate}
\item If ${(E_{n})}_{n}$ is a sequence of disjoint sets in $P$ and $E \supseteq \bigcup_{n} E_{n}$, $E \in P$, then
\[\sum_{n=1}^{\infty} \mu(E_{n}) \leq \mu(E).\]
\item If $E \subseteq F$, $E, F \in P$, then $\mu(E) \leq \mu(F)$.
\end{enumerate}
\end{lemma}
\begin{proof}
We first prove the first claim. By Lemma~\ref{semiring prop 1}, there are $F_{i} \in P$ disjoint such that
\[((((E_{1} \setminus E_{2}) \setminus E_{3}) \setminus \cdots) \setminus E_{m}) = \bigcup_{i=1}^{n} F_{i}.\]
In particular, $E$ is the disjoint union of the $E_{i}$ and $F_{i}$. Thus
\[\mu(E) = \sum_{i} \mu(E_{i}) + \sum_{j} \mu(F_{j}).\]
But $\mu$ is nonnegative so $\sum_{i} \mu(E_{i}) \geq 0$, thus the claim.

The second claim follows from the first in the case $n = 1$, $E_{1} = F$.
\end{proof}

\begin{subsec}
The power of Lemma~\ref{semiring prop 2} is that it does not assume that $\bigcup E_{n} \in P$.
\end{subsec}

\begin{subsec}
With these basic properties of premeasures set aside, we now discuss how to extend a premeasure to a measure.
First, we note that while premeasures are $\sigma$-additive, they also have another useful property, called $\sigma$-subadditivity.
\end{subsec}

\begin{definition}
Let $P$ be a set of sets. A function $\mu: P \to (-\infty, \infty]$ such that for every sequence of $E_{i} \in P$, if $E \in P$ and $E \subseteq \bigcup_{i} E_{i}$, then
\[\mu(E) \leq \sum_{i=1}^{\infty} \mu(E_{i}),\]
is said to be a \dfn{$\sigma$-subadditive function}.
\end{definition}

\begin{lemma}
Every premeasure is $\sigma$-subadditive.
\end{lemma}
\begin{proof}
Suppose that $E = \bigcup_{i} E_{i}$. By Lemma~\ref{semiring prop 1}, we can write
\[(((E_{i} \setminus E_{i-1}) \setminus E_{i-2}) \setminus \cdots \setminus E_{1}) = \bigcup_{j=1}^{k_{i}} F_{i}^{j}\]
where the $F_{i}^{j}$ are disjoint, hence
\[\mu(E) = \mu(E_{1}) + \sum_{i=2}^{\infty} \sum_{j=1}^{k_{i}} \mu(F_{i}^{j}).\]
But $\bigcup_{j} F_{i}^{j} \subseteq E_{i}$ so by Lemma~\ref{semiring prop 2},
\[\sum_{j=1}^{k_{i}} \mu(F_{i}^{j}) \leq \mu(E_{i}).\]
Thus
\[\mu(E) \leq \sum_{i=1}^{\infty} \mu(E_{i})\]
which was to be shown.
\end{proof}

\begin{subsec}
Because premeasures are $\sigma$-subadditive, it would be natural to extend them to a $\sigma$-subadditive function defined on a $\sigma$-ring. We do this now.
\end{subsec}

\begin{definition}
Let $R$ be a $\sigma$-ring.
An \dfn{outer measure} is a $\sigma$-subadditive function $\mu: R \to [0, \infty]$ such that $\mu(\emptyset) = 0$.
\end{definition}

\begin{subsec}
It follows from the definition that an outer measure $\mu$ is monotone; that is, if $E \subseteq F$, $E,F \in P$, then $\mu(E) \leq \mu(F)$.
\end{subsec}

\begin{subsec}
Let $\mu$ be a prmeasure.
We will now construct a $\sigma$-ring $R$ such that $\mu$ extends to an outer measure on $R$.
\end{subsec}

\begin{definition}
A set $\mathcal H$ whose elements are sets is said to be \dfn{hereditary} if for every $E \in \mathcal H$ and $F \subseteq E$, $F \in \mathcal H$.
\end{definition}

\begin{lemma}
For every semiring $P$ there is a smallest hereditary $\sigma$-ring $\mathcal H(P)$ such that $P \subseteq \mathcal H(P)$.
\end{lemma}
\begin{proof}
Let $X$ be the union of all elements in $P$. Then the power set $2^{X}$ is clearly a hereditary $\sigma$-ring such that $P \subseteq 2^{X}$.
The intersection of $\sigma$-rings containing $P$ is a $\sigma$-ring containing $P$, so it suffices to show that the intersection of hereditary sets is hereditary.

In fact, let $H$ be a set whose elements are hereditary sets, and let $\mathcal H$ be the intersection of $H$.
Let $E \in \mathcal H$; then for every $F \subseteq E$, $F$ is contained in every element of $H$, so $F \in \mathcal H$.
\end{proof}

\begin{definition}
Let $P$ be a semiring and $\mu$ be a premeasure on $P$. For every $A \in \mathcal H(P)$, define
\[\mu^{*}(A) = \inf \sum_{n=1}^{\infty} \mu(E_{n})\]
where the $\inf$ ranges over all sequenes of sets ${(E_{n})}_{n}$, $E_{n} \in P$, such that $A \subseteq \bigcup_{n} E_{n}$.
We call $\mu^{*}$ the \dfn{outer measure generated by $\mu$}.
\end{definition}

\begin{theorem}
Let $P$ be a semiring and $\mu$ be a premeasure on $P$. Then the outer measure $\mu^{*}$ generated by $\mu$ is an outer measure on $\mathcal H(P)$ and for every $E \in P$, $\mu^{*}(E) = \mu(E)$.
\end{theorem}
\begin{proof}
First, we check $\mu^{*}(\emptyset) = 0$. In fact, taking $E_{n} = \emptyset$ for every $n$, we have $\mu^{*}(\emptyset) \leq \sum_{n} 0 = 0$.

We now check that $\mu^{*}$ is $\sigma$-subadditive:
\begin{lemma}
Suppose that $A \in \mathcal H(P)$, $A_{n} \in \mathcal H(P)$, and $A \subseteq \bigcup_{n} A_{n}$. Then
\[\mu^{*}(A) \leq \sum_{n=1}^{\infty} \mu^{*}(A_{n}).\]
\end{lemma}
\begin{proof}[Proof of lemma]
Obviously this is true if some $\mu^{*}(A_{n}) = \infty$, so suppose that for every $n$, $\mu^{*}(A_{n}) < \infty$ and let $\varepsilon > 0$.
By definition of $\mu^{*}$, there are $E_{i}^{j} \in P$ such that $A_{i} \subseteq \bigcup_{j} E_{i}^{j}$
and
\[\mu^{*}(A_{i}) \geq \sum_{j=1}^{\infty} \mu(E_{i}^{j}) - \frac{\varepsilon}{2^{i}}.\]
Thus $A \subseteq \bigcup_{i,j}E_{i}^{j}$ whence
\begin{align*}\mu^{*}(A) &\leq \sum_{i,j} \mu(E_{i}^{j}) \leq \sum_{i,j=1}^{\infty} \mu(E_{i}^{j})\\ &\leq \sum_{i=1}^{\infty} \mu^{*}(A_{i}) + \frac{\varepsilon}{2_{i}}\\& \leq \varepsilon + \sum_{i=1}^{\infty} \mu^{*}(A_{i}).\end{align*}
This was to be shown.
\end{proof}

Finally we check that $\mu^{*}(A) = \mu(A)$ when $A \in P$. Clearly $\mu^{*}(A) \leq \mu(A)$.
Since $\mu$ is $\sigma$-subadditive, for any $E_{i} \in P$ such that $A \subseteq \bigcup_{i} E_{i}$, $\mu(A) \leq \sum_{i} \mu(E_{i})$, thus $\mu(A) \leq \mu^{*}(A)$.
\end{proof}

\begin{subsec}
There is a dual approach to the extension of premeasures, introduced by Lebesgue.
He considered not just outer measures but \dfn{inner measures} defined by the relation
\[\mu_{*}(E) = \sup \sum_{n=1}^{\infty} \mu(E_{n})\]
where the $\sup$ ranges over all sequences of $E_{n} \in P$ such that $\bigcup_{n} E_{n} \subseteq P$ and the $E_{n}$ are disjoint.
Then Lebesgue proposed to study the $\sigma$-ring of all sets whose inner and outer measures agree.
Note the asymmetry: for inner measure we need to assume that the $E_{n}$ are disjoint, or else we could ``double-count'' elements of $E$.
This asymmetry is the origin of several pathologies that make inner measures difficult to work with, and now this approach is considered nothing more than a historical footnote.
\end{subsec}

\begin{example}
An example of an oddity of inner measure comes from trying to compute the inner measure of the set $X$ of irrational numbers in $[0, 1]$.
Let $P$ be the semiring of intervals with rational endpoints in $[0, 1]$ and let $\mu$ be the Stieltjes premeasure on $P$ defined by $\mu([a, b)) = b - a$.
Then $\mu^{*}(X) = 1$.

To see this, let $x \in [0, 1]$; we will compute $\mu^{*}(\{x\})$. Let ${[x]}_{n}$ be a rational number such that ${[x]}_{n} < x < {[x]}_{n} + 1/n$; thus $\{x\} \subset [{[x]}_{n}, {[x]}_{n} + 1/n)$ and so
\[\mu^{*}(\{x\}) \leq \mu({[x]}_{n}, {[x]}_{n} + 1/n) = \frac{1}{n}\]
whence $\mu^{*}(\{x\}) = 0$.

Let ${(x_{n})}_{n}$ be an enumeration of the countable set $\QQ \cap [0, 1]$; by $\sigma$-subadditity,
\[\mu^{*}(\QQ \cap [0, 1]) \leq \sum_{n=1}^{\infty} \mu^{*}(\{x_{n}\}) = 0\]
but $X \cup (\QQ \cap [0, 1]) = [0, 1]$, so
\[1 = \mu([0, 1]) \leq \mu^{*}(X) + \mu^{*}(\QQ \cap [0, 1]) = \mu^{*}(X) + 0.\]
Therefore $\mu^{*}(X) \geq 1$, but $X \subseteq [0, 1]$ so $\mu^{*}(X) \leq 1$.

But there are no intervals in $P$ which are contained in $X$; thus the only element of $P$ contained in $E$ is $\emptyset$, so
\[\mu_{*}(E) = \sup 0 = 0.\]
Thus this seemingly reasonable way of defining an inner measure fails to measure the set of irrational numbers.
\end{example}

\begin{exercise}\label{semiring exercise}
Prove Lemma~\ref{semiring prop 1}.
\end{exercise}


\section{The Carathéodory construction}
Carathéodory introduced a modern approach that we now consider which avoids the issues with inner measures.
The idea is that, while an outer measure may not be a measure, there is a canonically defined $\sigma$-ring on which the outer measure will restrict to a measure.
The elements of that ring will be called measurable sets.

\begin{subsec}
The Carathéodory construction gives us a method to define measures: first define a premeasure, then check a certain technical hypothesis that we now state; then one has a unique measure which extends the premeasure.
\end{subsec}

\begin{definition}
Let $(X, \Sigma, \mu)$ be a measured space.
We say that $\mu$ is a \dfn{$\sigma$-finite measure} if there are countably many $E_{n} \in \Sigma$ such that $\bigcup_{n} E_{n} = X$ and $\mu(E_{n}) < \infty$.
We say that $\mu$ is a \dfn{complete measure} if for every $E \in \Sigma$ such that $\mu(E) = 0$ and $F \subseteq E$, $F \in \Sigma$.
\end{definition}

\begin{theorem}[Carathéodory construction]
Let $P$ a semiring of subsets of a set $X$ such that $X \in P$.
Let $\mu$ be a premeasure on $P$.
Then there is a $\sigma$-algebra $\Sigma$ which contains $P$ and an extension of $\mu$ to a complete measure on $\Sigma$.
Moreover, if $\mu$ is $\sigma$-finite, then $(X, \Sigma, \mu)$ is the unique measured space with this property.
\end{theorem}

\begin{subsec}
The rest of this section is devoted to the proof of the Carathéodory construction theorem.
We begin by constructing $\Sigma$.
We will do this by giving a property --- namely, ``measurability'' --- that every set in the $\sigma$-algebra $\Sigma$ ought to satisfy.
We will then show that the set of all measurable sets forms a $\sigma$-algebra; thus, we might as well define $\Sigma$ to be that $\sigma$-algebra.
\end{subsec}

\begin{subsec}
Let us fix an outer measure $\mu^{*}$ be an outer measure on a hereditary $\sigma$-ring $\mathcal H$.
In practice, $\mu^{*}$ will be the extension of a premeasure and $\mathcal H$ will be the $\sigma$-algebra of all subsets of some set.
\end{subsec}

\begin{definition}
A \dfn{$\mu^{*}$-measurable set} is a set $A \in \mathcal H$ such that for every $E \in \mathcal H$,
\begin{equation}\label{clean division}
\mu^{*}(E) = \mu^{*}(E \cap A) + \mu^{*}(E \setminus A).
\end{equation}
We let $\mathcal M(\mu^{*})$ denote the set of all $\mu^{*}$-measurable sets.
In the event that (\ref{clean division}) holds, we say that $A$ \dfn{cleanly divides} $E$, so a set $A$ is $\mu^{*}$-measurable if for every set $E \in \mathcal H$, $A$ cleanly divides $E$.
\end{definition}

\begin{subsec}
Since an outer measure is subadditive, one already has
\[\mu^{*}(E) \leq \mu^{*}(E \cap A) + \mu^{*}(E \setminus A)\]
and so one just has to prove the opposite inequality
\begin{equation}\label{Caratheodory inequality}
\mu^{*}(E \cap A) + \mu^{*}(E \setminus A) \leq \mu^{*}(E)
\end{equation}
to check that a set is $\mu^{*}$-measurable.
\end{subsec}

\begin{definition}
We say that a set $A \in \mathcal H$ is \dfn{$\mu^{*}$-null} if $\mu^{*}(A) = 0$.
We let $\mathcal N(\mu^{*})$ denote the set of all $\mu^{*}$-null sets.
\end{definition}

\begin{subsec}
Clearly $\emptyset$ is always $\mu^{*}$-null, and any subset of a $\mu^{*}$-null set is $\mu^{*}$-null, thus $\mathcal N(\mu^{*})$ is hereditary.
In general $\emptyset$ may be the only $\mu^{*}$-null set (think of counting measure), but as we will see, Stieltjes measures have lots of null sets.
We now show that every $\mu^{*}$-null set is measurable, and have no effect on measurability.
In fact, $\mu^{*}$-null sets will never matter much.
\end{subsec}

\begin{lemma}
The set $\mathcal N(\mu^{*})$ of $\mu^{*}$-null sets is a $\sigma$-ring, and $\mathcal N(\mu^{*}) \subseteq \mathcal M(\mu^{*})$.
Moreover, if $A$ is $\mu^{*}$-measurable and $Z$ is $\mu^{*}$-null, then $A \cup Z$ and $A \setminus Z$ are $\mu^{*}$-measurable.
\end{lemma}
\begin{proof}
Let $Z$ be $\mu^{*}$-null. Then for every $E$,
\[\mu^{*}(E \cap Z) + \mu^{*}(E \setminus Z) = 0 + \mu^{*}(E \setminus Z) \leq \mu^{*}(E)\]
since $\mathcal N(\mu^{*})$ is hereditary.
Thus $Z$ is $\mu^{*}$-measurable, so $\mathcal N(\mu^{*}) \subseteq \mathcal M(\mu^{*})$.
If $A$ cleanly divides $E$ then clearly so do $A \cup Z$ and $A \setminus Z$, so null sets have no effect on measurability.
Countable subadditivity implies that $\mathcal N(\mu^{*})$ is a $\sigma$-ring.
\end{proof}

\begin{lemma}\label{measurable complements lemma}
If $A_{1}, A_{2}$ are $\mu^{*}$-measurable sets, then so is $A_{1} \setminus A_{2}$.
\end{lemma}
\begin{proof}
Since $E$ is the disjoint union of the sets $E \cap (A_{1} \cap A_{2})$, $E \cap (A_{1} \setminus A_{2})$, $E \cap (A_{2} \setminus A_{1})$, and $E \cap (A_{1} \cup A_{2})$, this follows from the fact that $A_{1}$ and $A_{2}$ divide each of the above sets cleanly.
We leave the details as Exercise~\ref{measurable complements}.
\end{proof}

\begin{lemma}
For every outer measure $\mu^{*}$, the set of measurable sets $\mathcal M(\mu^{*})$ is a $\sigma$-ring and $\mu^{*}$ restricts to a measure on $\mathcal M(\mu^{*})$.
\end{lemma}
\begin{proof}

\end{proof}



TODO:\@ Show that $P$ has measurable sets

TODO:\@ Completions of measures

TODO:\@ Uniqueness of extensions

Leave lots of the above as exercises.

\begin{exercise}\label{measurable complements}
Fill in the details in the proof of Lemma~\ref{measurable complements lemma}.
\end{exercise}

\begin{exercise}
Let $(X, \Sigma, \mu)$ be a measured space. Show that the following are equivalent:
\begin{enumerate}
\item $\mu$ is $\sigma$-finite.
\item There are countably many disjoint $E_{i} \in \Sigma$, $\mu(E_{i}) < \infty$, such that $\bigcup_{i} E_{i} = X$.
\item There are countably many $E_{i} \in \Sigma$, $\mu(E_{i}) < \infty$, such that $E_{i} \subseteq E_{i+1}$ and $\bigcup_{i} E_{i} = X$.
\end{enumerate}
These equivalences are highly useful and will be used throughout the text without explicit mention.
\end{exercise}

\begin{exercise}
Let $(X, \Sigma, \mu)$ be a measured space, and let $\mathcal N$ be the $\sigma$-algebra of all null subsets of $\mu$. Let $\overline \Sigma$ be the $\sigma$-algebra generated by $\Sigma$ and $\mathcal N$.
Show that there is a unique extension $\overline \mu$ of $\mu$ to $(X, \overline \Sigma)$, and that $(X, \overline \Sigma, \overline \mu)$ is a complete measured space.
We call $(X, \overline \Sigma, \overline \mu)$ the \dfn{completion} of $(X, \Sigma, \mu)$.
\end{exercise}

\section{Lebesgue measure on $\RR$}
In this section we define the most important measure of all: Lebesgue measure on $\RR$.

\begin{subsec}
We begin by recalling that given a nondecreasing left-continuous function $f$ on $\RR$, the Stieltjes premeasure $\mu_{f}$ was given by
\[\mu_{f}([a, b)) = f(b) - f(a)\]
whenever $a < b$.
We can extend the semiring $P$ of half-open intervals to include $\RR$ by setting
\[\mu_{f}(\RR) = \lim_{n \to \infty} f(n) - f(-n),\]
which may be infinite, but always makes sense, since the only way that $\mu_{f}(\RR)$ could be $\infty - \infty$ is if
\[\lim_{x \to -\infty} f(x) = +\infty\]
which is impossible since $f$ is increasing.
Since the Stieltjes premeasure is a premeasure, it follows from the Carathéodory construction that there is a $\sigma$-algebra $\Sigma$ containing $P$ (and therefore containing the Borel $\sigma$-algebra $\mathcal B(\RR)$) and a measure, which we also call $\mu_{f}$, on $\Sigma$ which extends $\mu_{f}$.
\end{subsec}

\begin{lemma}
Every Stieltjes measure is $\sigma$-finite.
\end{lemma}
\begin{proof}
$\RR$ is covered by sets of the form $[n, n + 1)$, $n \in \ZZ$, of which there are countably many.
Now $\mu_{f}([n, n + 1)) = f(n+1) - f(n)$ is finite, so $\RR$ is $\sigma$-finite.
\end{proof}

\begin{subsec}
By the Carathéodory construction theorem, if a premeasure extends to a $\sigma$-finite complete measure $\mu$, then $\mu$ is the unique such extension.
It follows from the previous lemma that $\mu_{f}$ is well-defined.
More precisely, $\mu_{f}$ is the unique complete Borel measure obtained by extending the Stieltjes premeasure associated to $f$.
\end{subsec}

\begin{definition}
The \dfn{Stieltjes measure} arising from a nondecreasing left-continuous function $f$ is the complete Borel measure $\mu_{f}$ obtained from the Stieltjes premeasure of $f$.
\end{definition}

\begin{lemma}
If $\mu_{f}$ is a Stieltjes measure then for every open interval $(\alpha, \beta)$ one has
\[\mu_{f}((\alpha, \beta)) = f(\beta) - \lim_{n \to \infty} f(\alpha + 1/n).\]
In particular, if $f$ is continuous then $\mu_{f}((\alpha, \beta)) = f(\beta) - f(\alpha)$.
\end{lemma}
\begin{proof}
By continuity of measure,
\[\mu_{f}((\alpha, \beta)) = \lim_{n \to \infty} \mu_{f}([\alpha + 1/n, \beta)) = \lim_{n \to \infty} f(\beta) - f(\alpha + 1/n)\]
which is what we wanted.
\end{proof}

\begin{subsec}
In particular, if $f(x) = x$, then $\mu_{f}((\alpha, \beta)) = \beta - \alpha$.
This fact will be used so often that we will frequently use it without reference.
\end{subsec}

\begin{definition}
The \dfn{Lebesgue measure} on $\RR$ is the Stieltjes measure arising from the Lebesgue premeasure; that is, the Lebesgue measure is $\mu_{f}$ where $f(x) = x$.
\end{definition}

\begin{subsec}
Let $\mu$ denote Lebesgue measure; then $\mu([\alpha, \beta)) = \beta - \alpha$ is the length of the interval $[\alpha, \beta)$.
Therefore $\mu$ is the natural generalization of ``length'' to as many subsets of $\RR$ as one reasonably can generalize it to.
Indeed, if $A$ is a Lebesgue measurable subset of $\RR$ (e.g.\ if $A$ is Borel) then
\begin{equation}\label{lebesgue measure formula}
\mu(A) = \inf \left\{\sum_{j=1}^{\infty} \beta_{i} - \alpha_{i}: A \subseteq \bigcup_{i=1}^{\infty} [\alpha_{i}, \beta_{i})\right\}.
\end{equation}
\end{subsec}

\begin{theorem}\label{translation invariance in R1}
Lebesgue measure $\mu$ is \dfn{translation-invariant} in the sense that if $A$ is a Lebesgue measurable set, and $A + x = \{a + x: a \in A\}$, then $\mu(A) = \mu(A + x)$.
Conversely, if $\nu$ is a translation-invariant complete Borel measure such that $\nu([0, 1)) = 1$, then $\mu = \nu$.
\end{theorem}
\begin{proof}
If $A = [\alpha, \beta)$ is an interval, then $\mu(A + x) = \beta + x - \alpha - x = \beta - \alpha = \mu(A)$.
If $A$ is an arbitrary measurable set, then by (\ref{lebesgue measure formula}),
\begin{align*}
\mu(A + x) &= \inf \left\{\sum_{j=1}^{\infty} \beta_{i} - \alpha_{i}: A + x\subseteq \bigcup_{i=1}^{\infty} [\alpha_{i}, \beta_{i})\right\} \\
&= \inf \left\{\sum_{j=1}^{\infty} \beta_{i} + x- \alpha_{i} - x: A \subseteq \bigcup_{i=1}^{\infty} [\alpha_{i}, \beta_{i})\right\}\\
&= \inf \left\{\sum_{j=1}^{\infty} \beta_{i} - \alpha_{i}: A \subseteq \bigcup_{i=1}^{\infty} [\alpha_{i}, \beta_{i})\right\}\\
&= \mu(A).
\end{align*}

Conversely, $\nu$ is $\sigma$-finite, since by translation invariance, the sets $[n, n + 1)$ all have $\nu$-measure $1$, there are countably many of them, and they cover $\RR$.
Now if $[\alpha, \beta)$ is an arbitrary interval, we can write
\[[\alpha, \beta) = \bigcup_{n\in\ZZ} [\alpha, \beta) \cap [n, n + 1)\]
and use countable additivity to see that
\[\nu([\alpha, \beta)) = \sum_{n\in\ZZ} \nu([\alpha, \beta) \cap [n, n + 1)).\]
So it suffices to show that $\nu([\alpha, \beta)) = \mu([\alpha, \beta))$ whenever $[\alpha, \beta) \subseteq [n, n + 1)$ for some $n$, in order that this also be true for any interval $[\alpha, \beta)$.
Then by translation invariance, it suffices to check this when $\alpha = 0$, in which case $\beta \in (0, 1)$.

Suppose first that $\beta$ is rational, say $\beta = p/q$. Then by translation invariance and countable additivity,
\[\nu([\alpha, \beta)) = \nu([0, p/q)) = \sum_{j=0}^{p-1} \nu([j, (j+1)/q)) = p\nu([0, 1/q)).\]
But
\[1 = \nu([0, 1)) = \sum_{j=0}^{q-1} \nu([j, (j+1)/q)) = q\nu([0, 1/q))\]
which implies that $\nu([0, 1/q)) = 1/q$ and hence $\nu([0, p/q)) = p/q$; therefore $\nu([\alpha, \beta)) = \beta - \alpha$ whenever $\beta - \alpha$ is rational.
If $\beta - \alpha$ is irrational, choose $\beta_{n} > \beta_{n+1} > \cdots > \beta$ so that $\beta_{n} \to \beta$ and $\beta_{n} - \alpha$ is rational for all $n$; then $\nu([\alpha, \beta_{n})) = \beta_{n} - \alpha$, so continuity of measure implies that $\nu([\alpha, \beta)) = \beta - \alpha$.

Since $\mu([\alpha, \beta)) = \nu([\alpha, \beta))$ for all $\alpha < \beta$, uniqueness of the Carathéodory construction for $\sigma$-finite measures implies that $\mu = \nu$.
\end{proof}

\begin{subsec}
The above argument is an example of a ``bootstrapping'' strategy that is common in measure theory.
Once one has established a simple case (here $\nu([0, 1)) = 1$), it is often possible to propagate that case to a slightly more complicated case ($\nu([0, 1/q)) = 1/q$, say), and then repeat this process until all sets of interest have been considered.
If you find yourself stuck on an exercise, it is worth trying to prove the claim in the simplest possible case and then iteratively improving the cases your proof works for until all cases are hit.
\end{subsec}

\begin{subsec}
Theorem~\ref{translation invariance in R1} shows that we could have defined Lebesgue measure axiomatically. We would have had to demanded that:
\begin{enumerate}
\item Countable additivity: Lebesgue measure be a measure.
\item Borel: Every open interval be Lebesgue measurable.
\item Completeness: Every subset of a Lebesgue null set be null.
\item Translation-invariance: A translate of a Lebesgue measurable set have the same Lebesgue measurable.
\item Calibration: The interval $[0, 1)$ have Lebesgue measure $1$.
\end{enumerate}
Certainly all of these conditions seem quite tame; then the Carathéodory construction would have proven existence and uniqueness.
However, it is convenient to pass through the notion of a Stieltjes measure along the way, as more general Stieltjes measures are quite useful in their own right.
\end{subsec}

\begin{subsec}
One may wonder if \emph{every} subset of $\RR$ is Lebesgue measurable.
Under certain reasonable set-theoretic hypotheses, this is false; we discuss a counterexample, Vitali's set, in Example~\ref{Vitali set}.
But the next-best thing is true, as any set that an analyst, algebraist, topologist, or applied mathematician will ever have to work with will turn out to be measurable. We discuss this in Example~\ref{all functions are measurable}.
This is closely related to a theorem of Solovay~\cite{Solovay1970} which shows that in a certain sense, those set-theoretic hypotheses \emph{cannot} be avoided in the construction of a nonmeasurable set: a slightly different logical setup would imply that every subset of $\RR$ is measurable.
\end{subsec}

\begin{subsec}
Lebesgue measure is remarkably well-behaved, along with satisfying the five axioms above.
To see an example of another good property of Lebesgue measure, we need a new definition.
If the reader is uncomfortable with the abstract definition of a locally compact Hausdorff space, they may take $X = \RR$ in the following definition without losing any insight.
\end{subsec}

\begin{definition}\label{dfn of radon measure}
Let $X$ be a locally compact Hausdorff space.
Suppose that $\mu$ is a Borel measure on $X$ such that:
\begin{enumerate}
\item \dfn{Outer regularity}: For every Borel set $W$,
\[\mu(W) = \inf_{U} \mu(U)\]
where the infimum is taken over all open sets $U \supseteq W$.
\item \dfn{Inner regularity for open sets}: For every open set $U$,
\[\mu(U) = \sup_{K} \mu(K)\]
where the supremum is taken over all compact sets $K \subseteq U$.
\item \dfn{Local finiteness}: For every compact set $K$, $\mu(K) < \infty$.
\end{enumerate}
Then we say that $\mu$ is a \dfn{Radon measure}.
\end{definition}

\begin{theorem}\label{lebesgue is radon}
Every Stieltjes measure on $\RR$ is Radon.
In particular, Lebesgue measure is Radon.
\end{theorem}
\begin{proof}
Let $f$ be a nondecreasing left-continuous function.
If $K$ is compact then $K$ is bounded, so $K$ is contained in an interval $[\alpha, \beta)$ so $\mu_{f}(K) \leq f(\beta) - f(\alpha)$.
Therefore $\mu_{f}$ is locally finite.

For inner regularity, note that every open set $U$ can be written as a disjoint union of countably many open intervals, so it suffices to check when $U$ is the interval $(\alpha, \beta)$.
Now if $K \subset (\alpha, \beta)$ is compact then there is an $n$ such that $K \subseteq [\alpha + 1/n, \beta)$, so $\mu_{f}(K) \leq f(\beta) - f(\alpha + 1/n)$.
On the other hand,
\[\lim_{n \to \infty} \mu_{f}([\alpha + 1/n, \beta)) = f(\beta) - \lim_{n \to \infty} f(\alpha + 1/n) = \mu_{f}((\alpha, \beta)).\]
Therefore $\mu_{f}$ is inner regular.

For outer regularity, let $W$ be a Borel set (actually, any Stieltjes measurable set); then
\[\mu(W) = \inf_{(\alpha_{n}), (\beta_{n})} \sum_{n} f(\beta_{n}) - f(\alpha_{n})\]
where the $\inf$ ranges over all sequences of $\alpha_{n}$ and $\beta_{n}$ such that $W \subseteq \bigcup_{n} [\alpha_{n}, \beta_{n})$.
Fix any such sequences.
Now $E_{m}^{n} = (\alpha_{n} - m^{-1}2^{-n}, \beta_{n})$ is an open cover of $W$ for any $m$, so
\[\mu(W) \leq \sum_{n} f(\beta_{n}) - f(\alpha_{n}) < \frac{1}{m} + \sum_{n} f(\beta_{n}) - f(\alpha_{n}) = \sum_{n} f(\beta_{n}) - f(\alpha_{n}) + m^{-1}2^{-n}.\]
Taking $m \to \infty$ and minimizing $\sum_{n} f(\beta_{n}) - f(\alpha_{n})$ by varying the $\alpha_{n}$ and $\beta_{n}$ we collapse the above inequalities into $\inf$s.
\end{proof}

\begin{subsec}
The proof of Theorem~\ref{lebesgue is radon} shows that Stieltjes measures are not just outer regular for Borel sets, but outer regular for any Stieltjes measurable set whatsoever.
However, this fact is rarely useful; as discussed below, we are mainly interested in equivalence classes of sets modulo null sets, and every Lebesgue measurable set is equivalent under that equivalence relation to a Borel set.
\end{subsec}

\begin{subsec}
After this chapter, we will mainly be interested in not measurable sets, but rather equivalence classes of measurable sets under the equivalence relation ``symmetric difference is a null set''.
That is, we think of two measurable sets $A,B$ as the same if the symmetric difference $A \Delta B = (A \setminus B) \cup (B \setminus A)$ is null.
For example, every countable set is the same as the empty set.
One can give a different construction of the Lebesgue measure if one is \emph{only} interested in equivalence classes of measurable sets, rather than measurable sets themselves; see Exercises~\ref{physical lebesgue measure 1} through~\ref{physical lebesgue measure 3}.
\end{subsec}

\begin{figure}
\label{Cantor set figure}
\caption{The sets $C_{0}, \dots, C_{4}$ used in the construction of the Cantor set.}
\centering \includegraphics[width=0.5\textwidth]{graphics/CantorSet}
\end{figure}

\begin{subsec}
Let us now construct a useful example of an uncountable, null compact set, known as the \dfn{standard Cantor set}.
This set will frequently be useful as an example, and will be treated at length in the exercises.

Let $C_{0} = [0, 1]$, and given $C_{n}$ a finite union of closed intervals, let $C_{n+1}$ consist of $C_{n}$ with the open middle-thirds of each interval in $C_{n}$ removed.
See Figure \ref{Cantor set figure}.
Let $C$, the standard Cantor set, be defined by $C = \bigcap_{n} C_{n}$.
\end{subsec}

\begin{subsec}
It is often convenient to view the Cantor set in the following way. Let $2$ be a shorthand for the set $\{0, 1\}$.
Let $2^{\omega}$ denote the space of sequences in $2$, thus $2^{\omega}$ is the set of all functions $\NN \to \{0, 1\}$.

For each $x \in 2^{\omega}$, we obtain a point $f(x) \in C$ in the following way.
Assume that $D_{n-1}$ is one of the closed intervals obtained in stage $n-1$ of the Cantor set construction, thus $D_{n-1}$ is an interval in $C_{n-1}$.
If $x_{n} = 0$, let $D_{n}$ be the left closed interval in $D_{n-1}$, and otherwise let $D_{n}$ be the right closed interval.
Then $D_{n} \subseteq D_{n-1} \cap C_{n}$.
The intersection of closed nonempty intervals is a closed nonempty interval, so we obtain such an interval $D \subseteq C$.
But a consequence of Exercise~\ref{Cantor set props} is that the Cantor set contains no nontrivial intervals, so $D$ consists of a single point $f(x)$.

The map $f$ is injective since if $f(x) = f(y)$ then, at the $n$th stage of the Cantor set construction, both $x$ and $y$ agreed on which subinterval to pass to, thus $x = y$.
It is surjective since every point $p \in C$ must be in some interval $D_{n}$ at stage $n$, and if $D_{n}$ is the left interval of $D_{n-1}$ then we can set $x = 0$, and otherwise set $x = 1$; then $f(x) = p$.
One can similarly interpret the Cantor set as the set of all paths through the full infinite binary tree.
This perspective can be highly useful in some exercises and in applications.
For more on Cantor sets, see Pugh~\cite[Chapter 2]{pugh2013real}.
\end{subsec}

\begin{exercise}
Let $x \in \RR$ and let $f$ be a nondecreasing, left-continuous function. Show that
\[\mu_{f}(\{x\}) = \lim_{\varepsilon \to 0} f(x+\varepsilon) - f(x).\]
Conclude that if $f$ is continuous, then $\mu_{f}$ makes all countable sets null.
\end{exercise}

\begin{exercise}
Let $f$ be a nondecreasing, left-continuous function. Show that there is a nonempty open set $U$ such that $\mu_{f}(U) = 0$ iff $f$ is not strictly increasing (i.e.\ there are $x < y$ with $f(x) = f(y)$).
\end{exercise}

\begin{exercise}\label{Dirac measure}
Let $x \in \RR$. The \dfn{Dirac measure} at $x$, denoted $\delta_{x}$, is the Stieltjes measure arising from the function
\[y \mapsto \begin{cases}
0, &y \leq x\\
1, &y > x.
\end{cases}\]
A set is \dfn{Dirac measurable} at $x$ if it is measurable with respect to $\delta_{x}$.
Show that every subset of $\RR$ is Dirac measurable at $x$, and compute its Dirac measure.
\end{exercise}

\begin{exercise}\label{Cantor set props}
Show that the standard Cantor set is compact and Lebesgue null, has the same cardinality as $\RR$, and contains no interval except for points and the empty set.
\end{exercise}

\begin{exercise}
Let $\mu$ denote Lebesgue measure on $\RR$.
Show that there is a Borel probability measure $\nu$ on $\RR$, such that for every countable set $A$, $\nu(A) = 0$, and if $\mu(A) > 0$, then $\nu(A) = 0$.
(Hint: Define $\nu$ in such a way that, if $C$ denotes the standard Cantor set, then $\nu(C) = 1$, and use Exercise~\ref{Cantor set props}.)
\end{exercise}

\begin{exercise}
Show that the set of Lebesgue measurable subsets of $\RR$ has cardinality equal to that of the power set $2^{\RR}$ of $\RR$. Conclude that there exists a Lebesgue measurable set which is not Borel.
(Hint: Exercise~\ref{Cantor set props}.)
\end{exercise}

\begin{exercise}\label{fat cat}
Show that for every $\alpha \in [0, 1)$ there exists a Cantoresque subset $C_{\alpha}$ of $[0, 1]$ whose Lebesgue measure is $\alpha$.
In particular, $C_{\alpha}$ should be compact and contain no open subset of $\RR$.
This is known as a \dfn{fat Cantor set}.
Show that there does not exist a fat Cantor set of measure $1$ in $[0, 1]$.
\end{exercise}

\begin{exercise}\label{physical lebesgue measure 1}
In this exercise and the following we give a different construction of Lebesgue measure, other than the axiomatic definition or the construction using Stieltjes measures.

Let $\Sigma_{0}$ be the set of all intervals (open, closed, or half-open) with rational endpoints.
Given $I \in \Sigma_{0}$, define $\nu(I)$ to be the length of $I$.
If $I, J \in \Sigma_{0}$, then $I \setminus J \in \Sigma_{0}$, so we can define
\[d_{0}(I, J) = \nu(I \setminus J) + \nu(J \setminus I).\]
Show that $d_{0}$ is a semimetric, so the completion $(\Sigma, d)$ of $(\Sigma_{0}, d_{0})$ is a complete metric space, and $\nu$ is a continuous function on $\Sigma$.

Show that the ``union'' of countably many elements of $\Sigma$ is well-defined, as is the ``intersection'' of countably many elements and ``complement'' of one element.
That is, show that these operations drop to equivalence classes of elements of $\Sigma_{0}$ under the equivalence relation ``distance is $0$'', and then extend uniquely to $\Sigma$.
So $\Sigma$ can be thought of as an ``abstract $\sigma$-ring'' in some sense, even though its elements are not sets, but something more abstract.
\end{exercise}

\begin{exercise}\label{physical lebesgue measure 2}
Let all definitions be as Exercise~\ref{physical lebesgue measure 1}.
Given $J \in \Sigma_{0}$, define $[J]$ to be the equivalence class of $J$ in $\Sigma$.
Then, given $I \in \Sigma$, let
\[\nu(I) = d(I, [\emptyset]).\]
Show that $\nu$ is ``$\sigma$-additive'' in the sense that whenever ${(E_{n})}_{n}$ is a sequence in $\Sigma$ with $E_{n} \cap E_{m} = [\emptyset]$ whenever $n \neq m$, then
\[\nu\left(\bigcup_{n} E_{n}\right) = \sum_{n} \nu(E_{n}).\]
So we can think of $\nu$ as an ``abstract measure'' on the abstract $\sigma$-ring $\Sigma$.
We call $\nu$ the \dfn{physical Lebesgue measure}.
\end{exercise}

\begin{exercise}\label{physical lebesgue measure 3}
Let $\mu$ be Lebesgue measure and $\nu$ physical Lebesgue measure as in Exercise~\ref{physical lebesgue measure 2}, defined on the abstract $\sigma$-ring $\Sigma$.
Let $\Gamma$ be the $\sigma$-algebra of Lebesgue measurable subsets of $\RR$. Show that there is a surjective map $\pi: \Gamma \to \Sigma$ such that:
\begin{enumerate}
\item For every rational interval $I$, $\pi(I)$ is the equivalence class of $I$ in $\Sigma$.
\item For every sequence ${(E_{n})}_{n}$ in $\Gamma$, $\pi(\bigcup_{n} E_{n}) = \bigcup_{n} \pi(E_{n})$, and similarly for intersection and complement.
\item For every $E \in \Gamma$, $\mu(E) = \nu(\pi(E))$.
\end{enumerate}
So we can think of $\pi(E)$ as the equivalence class of $E$ under the equivalence relation ``symmetric difference is null'', and $\nu$ correctly computes the Lebesgue measurable of a set.
\end{exercise}
